<div class="manage-booking" [@routerTransition]>
    <div class="row margin-bottom-5">
        <div class="col-xs-6">
            <div class="page-head">
                <div class="page-title">
                    <h1>
                        <span>{{l("Booking.List")}}</span>
                    </h1>
                    <div></div>
                </div>
            </div>
        </div>
        <div class="col-xs-6 text-right">
        </div>
    </div>

    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <form class="form-horizontal">
                    <div class="card-header card-header-text" data-background-color="orange">
                        <h6 class="card-title">{{l("Search")}}</h6>
                    </div>

                    <div class="card-content">
                        <div class="row">
                            <div class="col-xs-6">
                                <div class="common-max-width">
                                    <label class="col-md-3 label-on-left">{{l("Booking.Name")}}</label>
                                    <div class="col-md-9">
                                        <div class="form-group label-floating is-empty">
                                            <label class="control-label"></label>
                                            <input class="form-control common-max-width" [(ngModel)]="bookingName" type="text" name="bookingName" placeholder="{{l('Booking.Name')}}">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-xs-6">
                                <div class="common-max-width">
                                    <label class="col-md-3 label-on-left">{{l("Search.CreationTime")}}</label>
                                    <div class="col-md-9" style="padding-right: 0; padding-left: 0;">
                                        <div class="col-md-6">
                                            <div class="form-group label-floating is-empty">
                                                <label class="control-label"></label>
                                                <input class="form-control startCreationTime" type="text" name="startCreationTime" placeholder="{{l('Search.CreationTime.ChooseStart')}}"
                                                    [(ngModel)]="startCreationTime" data-input>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group label-floating is-empty">
                                                <label class="control-label"></label>
                                                <input class="form-control endCreationTime" type="text" name="endCreationTime" placeholder="{{l('Search.CreationTime.ChooseEnd')}}"
                                                    [(ngModel)]="endCreationTime" data-input>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-xs-6">
                                <div class="common-max-width">
                                    <label class="col-md-3 label-on-left">{{l("Booking.TenantField")}}</label>
                                    <div class="col-md-9">
                                        <div class="form-group label-floating is-empty">
                                            <label class="control-label"></label>
                                            <kendo-dropdownlist [data]="outletSelectListData" (valueChange)="outletChangeHandler($event)" [textField]="'text'" [valueField]="'value'"
                                                [valuePrimitive]="true" [value]="outletSelectDefaultItem"></kendo-dropdownlist>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-xs-6">
                                <div class="common-max-width">
                                    <label class="col-md-3 label-on-left">{{l("Booking.State")}}</label>
                                    <div class="col-md-9">
                                        <div class="form-group label-floating is-empty">
                                            <label class="control-label"></label>
                                            <kendo-dropdownlist [data]="bookingActiveSelectListData" (valueChange)="bookingActiveChangeHandler($event)" [textField]="'displayText'"
                                                [valueField]="'value'" [valuePrimitive]="true" [defaultItem]="bookingActiveSelectDefaultItem"></kendo-dropdownlist>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row search-btn-wrap">
                            <div class="col-xs-6 col-md-2 col-md-offset-5 col-sm-3 col-sm-offset-3 common-min-width">
                                <div class="text-center">
                                    <button class="btn btn-block primary-bgcolor" (click)="loadData()"><i class="fa fa-search"></i> {{l("Search")}}</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div class="col-lg-12 booking-list-wrap" *ngIf="organizationBookingResultData">
            <!-- 翻转最外层，包含翻转前front-wrap / 翻转后back-wrap -->
            <div *ngFor="let bookingResultItem of organizationBookingResultData | paginate: { itemsPerPage: maxResultCount, currentPage: currentPage,totalItems: totalItems };let index = index"
                class="col-lg-3 col-md-4 col-sm-4 booking-item flip" #flipAni>
                <!--翻转前-->
                <div class="no-padding front-wrap box-shadow" #disabledAni [ngClass]="{'disabled-style': !bookingResultItem.isActive}">
                    <div class="top-banner-wrap">
                        <div class="org-bg" [ngStyle]="{'background-image': 'url(' + getBookingBgUrl(bookingResultItem.pictureUrl) + ')'}"></div>
                    </div>
                    <div class="booking-details">
                        <div class="xiaoyuyue-title-box">{{bookingResultItem.name}}</div>
                        <div class="content clearfix">
                            <div class="pull-left">
                                <div class="booking-overbrim" [ngClass]="countOverbrimState(bookingResultItem.subMaxBookingNum, bookingResultItem.subBookedNum)">
                                    <div class="wave">
                                        <span class="before" [ngStyle]="{'top': countOverbrimTop(bookingResultItem.subMaxBookingNum, bookingResultItem.subBookedNum)+'px'}"></span>
                                        <span class="after" [ngStyle]="{'top': countOverbrimTop(bookingResultItem.subMaxBookingNum, bookingResultItem.subBookedNum)-2+'px'}"></span>
                                    </div>
                                </div>
                                <div class="overbrim-value">{{ getOverbrimValue(bookingResultItem.subMaxBookingNum, bookingResultItem.subBookedNum) }}</div>
                            </div>
                            <div class="booking-info pull-right">
                                <div class="info-row-item">
                                    <span class="key">{{l('Booking.BookedNum')}}</span><span class="value">{{bookingResultItem.subBookedNum}}</span>
                                </div>
                                <div class="info-row-item">
                                    <span class="key">{{l('Booking.AvailBookingNum')}}</span><span class="value">{{bookingResultItem.subAvailBookingNum}}</span>
                                </div>
                                <div class="info-row-item">
                                    <span class="key">{{l('Booking.QueueNum')}}</span><span class="value">{{bookingResultItem.subQueueNum}}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 蒙版遮罩 -->
                    <div class="booking-item-cover unselectable clearfix" *ngIf="bookingResultItem.isActive">
                        <div class="qr-code-wrap">
                            <qr-code [value]="shareBaseUrl+bookingResultItem.id" [size]="118"></qr-code>
                        </div>
                        <div class="handle-wrap">
                            <div class="handle-item-1 row">
                                <span class="item col-md-6 col-sm-6 col-xs-6" *ngIf="isGranted(permissions.bookingManage_BookingDisable)" (click)="disabledBookingClass(disabledAni, index)"><i class="vapps-icon-app-disable"></i>{{l('Booking.Disabled')}}</span>
                                <span class="item col-md-6 col-sm-6 col-xs-6" (click)="shareHandler(bookingResultItem.id)"><i class="vapps-icon-app-share"></i>{{l('Booking.Share')}}</span>
                            </div>
                            <div class="handle-item-2 pull-right">
                                <span class="btn item-wrap" (click)="editHandler(bookingResultItem.id)" title="{{l('Booking.Edit')}}">
                                    <span class="show-icon vapps-icon-app-edit"></span>
                                <span class="show-text">{{l('Edit')}}</span>
                                </span>

                                <span class="btn item-wrap" (click)="copyBooking(index)" title="{{l('Booking.Copy')}}">
                                    <span class="show-icon vapps-icon-app-copy-1"></span>
                                <span class="show-text">{{l('Copy')}}</span>
                                </span>

                                <span class="btn item-wrap" (click)="flipToBack(flipAni, $event)" title="{{l('Booking.Detail')}}">
                                    <span class="show-icon vapps-icon-app-detail"></span>
                                <span class="show-text">{{l('Detail')}}</span>
                                </span>

                                <span class="btn item-wrap" (click)="removeBooking(index)" title="{{l('Booking.Delete')}}">
                                    <span class="show-icon vapps-icon-app-delete"></span>
                                <span class="show-text">{{l('Delete')}}</span>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="booking-item-cover clearfix" *ngIf="!bookingResultItem.isActive">
                        <div class="handle-wrap">
                            <div class="handle-item-1 row">
                                <span class="item col-md-6 active" (click)="beforeBookingClass(disabledAni, index)">
                                    <i class="vapps-icon-app-active"></i>{{l('Active')}}
                                </span>
                            </div>
                            <div class="handle-item-2 pull-right">
                                <span class="btn item-wrap" *ngIf="isGranted(permissions.bookingManage_BookingEdit)" (click)="editHandler(bookingResultItem.id)"
                                    title="{{l('Booking.Edit')}}">
                                    <span class="show-icon vapps-icon-app-edit"></span>
                                <span class="show-text">{{l('Edit')}}</span>
                                </span>

                                <span class="btn item-wrap" *ngIf="isGranted(permissions.bookingManage_BookingCopy)" (click)="flipToBack(flipAni, $event)"
                                    title="{{l('Booking.Detail')}}">
                                    <span class="show-icon vapps-icon-app-detail"></span>
                                <span class="show-text">{{l('Detail')}}</span>
                                </span>

                                <span class="btn item-wrap" *ngIf="isGranted(permissions.bookingManage_BookingDelete)" (click)="removeBooking(index)" title="{{l('Booking.Delete')}}">
                                    <span class="show-icon vapps-icon-app-delete"></span>
                                <span class="show-text">{{l('Delete')}}</span>
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- 待确认人数  -->
                    <div class="wait-confirm-num" *ngIf="bookingResultItem.wait4ConfirmNum > 0" (click)="showConfirmOrderHandler(bookingResultItem.id)">{{ bookingResultItem.wait4ConfirmNum}}</div>
                </div>
                <!--翻转后-->
                <div class="back-wrap box-shadow">
                    <div class="portlet light portlet-fit">
                        <div class="portlet-title">
                            <div class="caption">
                                <span class="caption-subject">{{l("Booking.Detail")}}</span>
                            </div>
                        </div>
                        <div class="portlet-body content-wrap clearfix">
                            <div class="content-item">
                                <div class="name orange-color">{{bookingResultItem.name}}</div>
                                <span class="vapps-icon-app-edit orange-color" (click)="editHandler(bookingResultItem.id)"></span>
                            </div>
                            <div class="content-item">
                                <div class="name">{{l("Booking.Outlet")}}</div>
                                <div class="desc text-overflow orange-color" [title]="bookingResultItem.outlet">{{bookingResultItem.outlet}}</div>
                            </div>
                            <div class="content-item">
                                <div class="name">{{l("Booking.Datetime")}}</div>
                                <div class="desc text-overflow" [title]="bookingResultItem.availableBookingTime">{{bookingResultItem.availableBookingTime}}</div>
                            </div>
                            <div class="content-item">
                                <div class="name">{{l("Booking.OutletAddress")}}</div>
                                <div class="desc text-overflow" [title]="bookingResultItem.outletAddress">{{bookingResultItem.outletAddress}}</div>
                            </div>
                            <div class="content-item">
                                <div class="name">{{l("Booking.Contactor")}}</div>
                                <div class="desc text-overflow">{{bookingResultItem.contactor}}</div>
                            </div>
                            <div class="content-item">
                                <div class="name">{{l("Booking.PhoneNumber")}}</div>
                                <div class="desc text-overflow">{{bookingResultItem.contactorPhoneNum}}</div>
                            </div>
                            <div class="content-item">
                                <div class="name"><span class="booking-custom-btn light-bgcolor btn" (click)="showBookingCostomHandler(bookingResultItem)">{{l('BookingOrder.List')}}</span></div>
                            </div>
                            <div class="back clearfix" (click)="flipToFront(flipAni, $event)">
                                <span class="vapps-icon-app-back btn btn-xs  light-bgcolor pull-right"></span>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <div class="col-lg-12" *ngIf="organizationBookingResultData">
            <div class="pull-right">
                <div class="has-text-centered">
                    <pagination-controls (pageChange)="onPageChange($event)" previousLabel="" nextLabel="" autoHide="false"></pagination-controls>
                </div>
            </div>
        </div>
    </div>
</div>
<xiaoyuyue-share-booking-model #shareBookingModel></xiaoyuyue-share-booking-model>
<xiaoyuyue-confirm-order-model #confirmOrderModelComponent (isShowModelHander)="isShowConfirmOrderModelHandler($event)"></xiaoyuyue-confirm-order-model>
<xiaoyuyue-booking-custom-model #bookingCustomModelComponent></xiaoyuyue-booking-custom-model>